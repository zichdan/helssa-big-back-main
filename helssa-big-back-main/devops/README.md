# Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† DevOps - Ù…Ø¯ÛŒØ±ÛŒØª Ø²ÛŒØ±Ø³Ø§Ø®Øª Ùˆ Ø§Ø³ØªÙ‚Ø±Ø§Ø±

Ø§ÛŒÙ† Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø²ÛŒØ±Ø³Ø§Ø®ØªØŒ deploymentØŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ùˆ CI/CD Ø¯Ø± Ù¾Ù„ØªÙØ±Ù… Ù‡Ù„Ø³Ø§ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.

## ğŸ“‹ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§

### Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§ (Environment Management)
- ØªØ¹Ø±ÛŒÙ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù (development, staging, production)
- Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù…Ø²Ù‡Ø§ÛŒ Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ (Secrets Management)
- Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ùˆ Ù…Ø¬ÙˆØ²Ù‡Ø§

### Ù…Ø¯ÛŒØ±ÛŒØª Docker Ùˆ Container
- Ú©Ù†ØªØ±Ù„ Docker containers
- Ù…Ø¯ÛŒØ±ÛŒØª Docker Compose services
- Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ ÙˆØ¶Ø¹ÛŒØª containers
- Ø¯Ø±ÛŒØ§ÙØª Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ùˆ Ø¢Ù…Ø§Ø±

### Ø³ÛŒØ³ØªÙ… Deployment
- Ø§Ø¬Ø±Ø§ÛŒ deployment Ø®ÙˆØ¯Ú©Ø§Ø±
- Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Git branches Ù…Ø®ØªÙ„Ù
- Ù‚Ø§Ø¨Ù„ÛŒØª Rollback Ø¨Ù‡ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
- Ø«Ø¨Øª Ú©Ø§Ù…Ù„ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ deployment

### Health Check Ùˆ Monitoring
- Ø¨Ø±Ø±Ø³ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
- Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù…Ù†Ø§Ø¨Ø¹ Ø³ÛŒØ³ØªÙ… (CPU, Memory, Disk)
- Ù…Ø­Ø§Ø³Ø¨Ù‡ Uptime Ùˆ Ø¢Ù…Ø§Ø±Ù‡Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯
- Ø³ÛŒØ³ØªÙ… Ù‡Ø´Ø¯Ø§Ø± Ø®ÙˆØ¯Ú©Ø§Ø±

### Management Commands
- Ø¯Ø³ØªÙˆØ±Ø§Øª CLI Ø¨Ø±Ø§ÛŒ automation
- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§
- Ø§Ø¬Ø±Ø§ÛŒ deployment Ø§Ø² command line
- Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ùˆ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯

## ğŸš€ Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### 1. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ INSTALLED_APPS

```python
# settings.py
INSTALLED_APPS = [
    # ... Ø³Ø§ÛŒØ± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§
    'devops',
]
```

### 2. Ø§Ø¬Ø±Ø§ÛŒ Migration Ù‡Ø§

```bash
python manage.py makemigrations devops
python manage.py migrate
```

### 3. ØªÙ†Ø¸ÛŒÙ… URL Ù‡Ø§

```python
# urls.py
urlpatterns = [
    # ... Ø³Ø§ÛŒØ± URL Ù‡Ø§
    path('devops/', include('devops.urls')),
]
```

### 4. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø­ÛŒØ·

```bash
# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÛŒØ¹ Ù…Ø­ÛŒØ· development
python manage.py setup_environment --environment development --type development --quick-setup

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§Ø² ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
python manage.py setup_environment --config environments.json
```

## ğŸ“ Ù…Ø«Ø§Ù„ ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª

```json
{
  "environments": [
    {
      "name": "production",
      "environment_type": "production",
      "description": "Ù…Ø­ÛŒØ· ØªÙˆÙ„ÛŒØ¯ Ø§ØµÙ„ÛŒ",
      "is_active": true
    },
    {
      "name": "staging", 
      "environment_type": "staging",
      "description": "Ù…Ø­ÛŒØ· ØªØ³Øª Ù‚Ø¨Ù„ Ø§Ø² ØªÙˆÙ„ÛŒØ¯",
      "is_active": true
    }
  ],
  "monitoring": [
    {
      "environment": "production",
      "service_name": "web",
      "service_type": "web",
      "health_check_url": "https://helssa.ir/health/",
      "check_interval": 300,
      "timeout": 30
    },
    {
      "environment": "production",
      "service_name": "database",
      "service_type": "database", 
      "health_check_url": "https://helssa.ir/health/",
      "check_interval": 600,
      "timeout": 15
    }
  ]
}
```

## ğŸ› ï¸ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Management Commands

### Health Check
```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ú©Ù„ÛŒ Ø³ÛŒØ³ØªÙ…
python manage.py health_check

# Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ÛŒØ· Ø®Ø§Øµ
python manage.py health_check --environment production

# Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø®Ø§Øµ
python manage.py health_check --environment production --service web

# Ø®Ø±ÙˆØ¬ÛŒ JSON
python manage.py health_check --json --fail-on-error
```

### Deployment
```bash
# deployment Ø¬Ø¯ÛŒØ¯
python manage.py deploy --environment production --version v1.2.3

# deployment Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®Ø§Øµ
python manage.py deploy -e staging -v v1.2.3 --branch develop --no-migrations

# rollback
python manage.py rollback --environment production --target-deployment-id abc-123-def
```

### Ù…Ø¯ÛŒØ±ÛŒØª Docker
```bash
# Ù…Ø´Ø§Ù‡Ø¯Ù‡ containers
python manage.py docker_manage --action ps

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ container
python manage.py docker_manage --action restart --container web

# ÙˆØ¶Ø¹ÛŒØª Docker Compose
python manage.py docker_manage --action compose-status

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
python manage.py docker_manage --action compose-restart --services web worker
```

## ğŸ”Œ API Endpoints

### Health Check
- `GET /devops/health/` - Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ú©Ù„ÛŒ
- `GET /devops/health/{environment}/` - Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ù…Ø­ÛŒØ· Ø®Ø§Øµ

### Docker Management
- `GET /devops/docker/containers/` - Ù„ÛŒØ³Øª containers
- `POST /devops/docker/containers/` - Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ containers
- `GET /devops/docker/compose/` - ÙˆØ¶Ø¹ÛŒØª compose services
- `POST /devops/docker/compose/` - Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ compose

### Deployment
- `POST /devops/deploy/` - Ø´Ø±ÙˆØ¹ deployment Ø¬Ø¯ÛŒØ¯
- `POST /devops/rollback/` - rollback deployment

### Monitoring
- `GET /devops/uptime/{environment}/{service}/` - uptime Ø³Ø±ÙˆÛŒØ³
- `GET /devops/metrics/` - Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³ÛŒØ³ØªÙ…
- `GET /devops/metrics/{environment}/` - Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ù…Ø­ÛŒØ· Ø®Ø§Øµ

### ViewSets (CRUD)
- `/devops/api/environments/` - Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§
- `/devops/api/deployments/` - ØªØ§Ø±ÛŒØ®Ú†Ù‡ deployments
- `/devops/api/health-checks/` - Ù†ØªØ§ÛŒØ¬ health checks
- `/devops/api/service-monitoring/` - ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯

## ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Celery

### Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Tasks Ø¨Ù‡ Beat Schedule

```python
# settings.py
from celery.schedules import crontab

CELERY_BEAT_SCHEDULE = {
    # Health checks Ù‡Ø± 5 Ø¯Ù‚ÛŒÙ‚Ù‡
    'run-health-checks': {
        'task': 'devops.tasks.run_health_checks',
        'schedule': crontab(minute='*/5'),
    },
    
    # Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ health checks Ù‚Ø¯ÛŒÙ…ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡
    'cleanup-health-checks': {
        'task': 'devops.tasks.cleanup_old_health_checks',
        'schedule': crontab(hour=2, minute=0),  # Ø³Ø§Ø¹Øª 2 ØµØ¨Ø­
    },
    
    # Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù…Ù†Ø§Ø¨Ø¹ Ø³ÛŒØ³ØªÙ… Ù‡Ø± 10 Ø¯Ù‚ÛŒÙ‚Ù‡
    'monitor-system-resources': {
        'task': 'devops.tasks.monitor_system_resources',
        'schedule': crontab(minute='*/10'),
    },
    
    # Ø¨Ø±Ø±Ø³ÛŒ deployment Ù‡Ø§ÛŒ Ú¯ÛŒØ± Ú©Ø±Ø¯Ù‡ Ù‡Ø± Ø³Ø§Ø¹Øª
    'check-deployment-status': {
        'task': 'devops.tasks.check_deployment_status',
        'schedule': crontab(minute=0),  # Ø§Ø¨ØªØ¯Ø§ÛŒ Ù‡Ø± Ø³Ø§Ø¹Øª
    },
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ deployment Ø±ÙˆØ²Ø§Ù†Ù‡
    'backup-deployment-logs': {
        'task': 'devops.tasks.backup_deployment_logs',
        'schedule': crontab(hour=3, minute=0),  # Ø³Ø§Ø¹Øª 3 ØµØ¨Ø­
    },
}
```

## ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§

```bash
# Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ devops
python manage.py test devops

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ
python manage.py test devops.tests.HealthServiceTestCase

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ coverage
coverage run --source='.' manage.py test devops
coverage report
coverage html
```

## ğŸ“Š Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡

### 1. Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ÛŒØ· Ø¬Ø¯ÛŒØ¯

```python
from devops.models import EnvironmentConfig

# Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ÛŒØ· staging
staging_env = EnvironmentConfig.objects.create(
    name='staging',
    environment_type='staging', 
    description='Ù…Ø­ÛŒØ· ØªØ³Øª Ù‚Ø¨Ù„ Ø§Ø² production'
)
```

### 2. ØªÙ†Ø¸ÛŒÙ… Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø³Ø±ÙˆÛŒØ³

```python
from devops.models import ServiceMonitoring

# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø±ÙˆÛŒØ³ web Ø¨Ù‡ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯
web_monitoring = ServiceMonitoring.objects.create(
    environment=staging_env,
    service_name='web',
    service_type='web',
    health_check_url='https://staging.helssa.ir/health/',
    check_interval=300,  # Ù‡Ø± 5 Ø¯Ù‚ÛŒÙ‚Ù‡
    timeout=30
)
```

### 3. Ø§Ø¬Ø±Ø§ÛŒ deployment Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ

```python
from devops.services.deployment_service import DeploymentService

# deployment Ø¨Ù‡ staging
deployment_service = DeploymentService('staging')
deployment = deployment_service.deploy(
    version='v1.2.3',
    branch='develop',
    user=request.user
)

print(f"Deployment status: {deployment.status}")
```

### 4. Ø¨Ø±Ø±Ø³ÛŒ health check

```python
from devops.services.health_service import HealthService

# Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª staging
health_service = HealthService('staging')
result = health_service.comprehensive_health_check()

print(f"Overall status: {result['overall_status']}")
for service, status in result['services'].items():
    print(f"{service}: {status['status']}")
```

## ğŸ”’ Ø§Ù…Ù†ÛŒØª

### Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Secrets
- ØªÙ…Ø§Ù… secrets Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Django Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ secrets Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…Ø¬Ø§Ø² Ø§Ø³Øª
- Ø§Ù…Ú©Ø§Ù† ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§ Ø¨Ø±Ø§ÛŒ secrets

### Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ
- ØªÙ…Ø§Ù… API Ù‡Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¯Ø§Ø±Ù†Ø¯
- Rate limiting Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø³ÙˆØ¡ Ø§Ø³ØªÙØ§Ø¯Ù‡
- Ù„Ø§Ú¯ Ú©Ø§Ù…Ù„ ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª

### Audit Trail
- Ø«Ø¨Øª Ú©Ø§Ù…Ù„ ØªØ§Ø±ÛŒØ®Ú†Ù‡ deployments
- Ù„Ø§Ú¯ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§
- Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø¬Ø±Ø§Ú©Ù†Ù†Ø¯Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª

## ğŸ“ˆ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ùˆ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§

### Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ
- Deployment success rate
- Service uptime percentage  
- Response time averages
- Resource utilization (CPU/Memory/Disk)

### Ø³ÛŒØ³ØªÙ… Ù‡Ø´Ø¯Ø§Ø±
- Ø§Ø¹Ù„Ø§Ù† Ø®Ø±Ø§Ø¨ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
- Ù‡Ø´Ø¯Ø§Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø§Ù„Ø§ÛŒ Ù…Ù†Ø§Ø¨Ø¹
- Ø§Ø·Ù„Ø§Ø¹ deployment Ù‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚
- Ø¢Ú¯Ø§Ù‡ÛŒ Ø§Ø² Ø§Ù†Ù‚Ø¶Ø§ÛŒ secrets

## ğŸ¤ Ù…Ø´Ø§Ø±Ú©Øª

Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ø±Ú©Øª Ø¯Ø± ØªÙˆØ³Ø¹Ù‡:

1. Ú©Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯
2. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
3. Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯
4. Pull Request Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯

## ğŸ“š Ù…Ù†Ø§Ø¨Ø¹ Ø§Ø¶Ø§ÙÛŒ

- [Ù…Ø³ØªÙ†Ø¯Ø§Øª Django](https://docs.djangoproject.com/)
- [Docker Documentation](https://docs.docker.com/)
- [Celery Documentation](https://docs.celeryproject.org/)
- [REST Framework](https://www.django-rest-framework.org/)

---

Â© 2024 Helssa Platform - ØªÙ…Ø§Ù… Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª