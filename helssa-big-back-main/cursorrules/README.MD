# ğŸš€ Agent Governance

### Purpose & Scope

This directive applies to all contributorsâ€”humans and agentsâ€”working in this repository (and related modules). It governs changes on all branches when work results in a pull request; the default base for comparison is `develop` (override via `BASE_BRANCH` if your project uses a different base).

## ğŸ“Œ Canonical Rule

**âš ï¸ Hard rule.** â© Before any action â–¶ï¸, the ğŸ¤– must ğŸ“– read the **entire** `agent/` ğŸ“ and ğŸ“Œ follow it **verbatim**. If any adâ€‘hoc ğŸ—’ï¸ â›”ï¸ conflicts with `agent/` prescriptions: â‘  ğŸ§¾ record the conflict (provenance: ğŸ—‚ï¸ path + #ï¸âƒ£ line) â‘¡ ğŸ›‘ stop execution.

## ğŸš«ğŸŒ€ Nonâ€‘Contradiction Doctrine

### ğŸ” Decision Tree (Short)

- **Conflict in canonical rules?** If two prescriptions (same scope/time) in `agent/` or between `agent/` and an adâ€‘hoc request **cannot both be true**, treat as a **contradiction** â†’ ğŸ›‘ stop â†’ file a Paradox Report.
- **Extension without violation?** If an adâ€‘hoc request *adds* behavior **without violating** any `agent/` rule *and* `agent/` permits extensions, it is a **permissible deviation** â†’ proceed.
- **Ambiguous or underspecified?** If requirements are unclear or incomplete, treat as **insufficient information** â†’ do **not** proceed; document questions in the report and ping reviewers.

### ğŸ§© Examples

- **Contradiction:** `agent/` mandates **presigned, timeâ€‘bounded URLs** for downloads; an adâ€‘hoc request instructs to **expose public URLs**. â†’ Stop, report.
- **Permissible deviation:** tests exceed the minimum coverage target without altering security policy. â†’ Proceed.

### â±ï¸ SLA for Filing

- Submit the **Paradox Report** within **1 business hour** of detection (absolute max: **24h**). Name it using UTC: `agent/reports/YYYYâ€‘MMâ€‘DDTHHMMZ-paradox.md`.

### ğŸš¨ Escalation Path

- Tag **CODEOWNERS** (auto) and notify `@maintainers`. If security/privacy is implicated, also notify `@security`.
- If blocked, open a **Draft PR** containing the report to provide visibility while awaiting guidance.

The ğŸ¤– must **not proceed** when specs âš™ï¸ğŸ”€ contradict or yield a ğŸŒ€ paradox.

### ğŸ§¾ Paradox Report â€” Required Contents

**Naming convention (UTC):** `agent/reports/YYYYâ€‘MMâ€‘DDTHHMMZ-paradox.md` (e.g., `2025-08-28T1432Z-paradox.md`). Use UTC ("Z"). If UTC is unavailable, fallback to `YYYYMMDD-HHMM-paradox.md`.

**Miniâ€‘template:**

```md
# Paradox Report
- Report ID: 2025-08-28T1432Z-paradox
- Author: <name or bot id>
- Branch: <feature/...>
- Task/Issue: <link or ID>
- Timestamp (UTC): 2025-08-28T14:32:00Z

## Conflict Excerpts
- File: path/to/file.py:123â€“128
  > "â€¦verbatimâ€¦"
- File: agent/README.md:45â€“51
  > "â€¦verbatimâ€¦"

## Analysis
<brief synthesis explaining locus and nature of the contradiction>

## Proposed Resolution / Questions
<clear next steps or questions for maintainers>

## Notifications
- Notified: @owner1 @owner2
```

Upon detection:

1. ğŸ›‘ **Stop** immediately.
2. âœï¸ Create a **Paradox Report** with: â±ï¸ UTC timestamp Â· ğŸ”— task/issue reference Â· ğŸ“ verbatim conflicting snippets with ğŸ—‚ï¸ file paths and #ï¸âƒ£ line numbers Â· ğŸ§  concise analysis Â· ğŸ§­ proposed resolution or â“ questions.
3. ğŸ’¾ Save at: `agent/reports/YYYYMMDD-HHMM-paradox.md` (ğŸ“ autoâ€‘create if missing).
4. ğŸ’¾ **Commit** and â¤´ï¸ **push** the report to **your branch**.

## ğŸ§µ Terminal Workflow â€” Always (Base: `develop` by default; set `BASE_BRANCH` if different â€¢ Required CI: lint, tests, coverage â‰¥ 85% (â‰¥ 90% core) â€¢ CODEOWNERS review required â€¢ Use Draft PR when paradoxâ€‘blocked)

1. ğŸ’¾ **Commit** all changes (or the ğŸ§¾ Paradox Report if work halted).
2. â¤´ï¸ **Push** to **your branch**.
3. ğŸ”€ **Open a PR**: `your-branch` â†’ `` (base: `develop`).
4. ğŸ·ï¸ **Label the PR (required)** â€” select â‰¥ 1 from **each** set:
   - **Change Type:** âœ¨ `feature` Â· ğŸ› ï¸ `fix` Â· ğŸ“ `docs` Â· â™»ï¸ `refactor` Â· ğŸ§ª `test` Â· ğŸš€ `perf` Â· ğŸ”’ `security` Â· ğŸ§¹ `chore` Â· ğŸ—ï¸ `build` Â· ğŸ¤– `ci`.
   - **Subsystem/Scope:** ğŸ¤– `agent` Â· ğŸ `backend/django` Â· ğŸ§® `db/pgvector` Â· â˜ï¸ `storage/minio` Â· ğŸ“± `frontend/flutter` Â· âš™ï¸ `infra/devops`.
   - **Impact/Status (if applicable):** ğŸ’¥ `breaking-change` Â· ğŸ” `migration` Â· ğŸš‘ `hotfix` Â· ğŸ‘€ `needs-review` Â· â›”ï¸ `blocked/paradox`.
5. ğŸ§¾ **PR body** must include: ğŸ¯ objective Â· ğŸ§¾ changeset synopsis Â· âš ï¸ risk/impact Â· ğŸ”¬ verification notes Â· ğŸ”— links to issues/tasks.
6. ğŸš« **Do not merge.** â³ Wait for âœ… CI and ğŸ‘¤ human review/approval.

## ğŸŒ¿ Branching & ğŸ§¾ Commit Semantics

- ğŸŒ¿ Naming: `feature/<short-desc>` or `fix/<short-desc>`.
- ğŸ§¾ Use **Conventional Commits** (e.g., `feat: â€¦`, `fix: â€¦`, `docs: â€¦`).

## ğŸ” TL;DR

`agent/` = ğŸ”ğŸ“– single source of truth. If ğŸŒ€ arises: **report â†’ ğŸ’¾ save â†’ ğŸ’¾ commit & â¤´ï¸ push â†’ ğŸ”€ PR â†’ ğŸ·ï¸ label â†’ â³ review**.

**TL;DR (emojiâ€‘light):** `agent/` is the single source of truth. On contradiction: report â†’ save â†’ commit & push â†’ open PR to `develop` â†’ label â†’ await review.

